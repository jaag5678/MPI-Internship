\subsection{Soundness of the rules above}

    To prove soundness, we first define the following: 

    \begin{definition}{Implied Write Order(\emph{iwo})}
        \label{ImpliedW}
        Binary relation between any two \emph{distinct} writes of symmetric threads, derived through the following two sequential conposition:  
        \begin{align*}
            w_i^j;po;rf^{-1};w_k^j \\
            w_i^j;rf;po;w_k^j 
        \end{align*}
    \end{definition}

%---------------------------------------------------------------------------------------------------------------------------------------

    \begin{property}
        \label{Wabv}
        $w_i^j;po;rf^{-1};w_k^j$ corresponds to an implied write order between writes above the read((po before read)) and $T_i$'s read being satisfied. 
    \end{property}
    
    \begin{proof}
        Expanding the first sequential composition exposes the following relations involved. 
        \begin{align*}
            \reln{w_i^j}{po}{r_i} \\ 
            \reln{r_i}{rf^{-1}}{w_k^j}
        \end{align*}
        By Def \ref{ProgO}, $w_i^j$ is above its read $r_i$. Because $T_i$ and $T_k$ are symmetric threads, we can infer $\reln{w_k^j}{po}{r_k}$, thus verifying that $w_k^j$ is also above its read. 
        By Def \ref{ReadF}, we can infer $\reln{w_k^j}{rf}{r_i}$ implying $T_i$'s read being satisfied.   
    \end{proof}

%-------------------------------------------------------------------------------------------------------------------------------------

    \begin{property}
        \label{Wbel}
        $w_i^j;rf;po;w_k^j$ corresponds to an implied write order between writes below the read (po after read) and $T_k$'s read being satisfied.
    \end{property}

    \begin{proof}
        Expanding the first sequential composition exposes the following relations involved. 
        \begin{align*}
            \reln{w_i^j}{rf}{r_k} \\ 
            \reln{r_k}{po}{w_k^j}
        \end{align*}
        By Def\ref{ProgO}, $w_k^j$ is below its read $r_k$. Because $T_i$ and $T_k$ are symmetric threads, we can infer $\reln{r_i}{po}{w_i^j}$, thus verifying that $w_i^j$ is also below its read.
        By Def \ref{ReadF}, we can infer $T_k$'s read being satisfied. 
    \end{proof}

%-------------------------------------------------------------------------------------------------------------------------------------

    \begin{property}{Simplified irreflexivity rule}
        \label{prop1}
        The irreflexivity constraint rule is equivalent to the following irreflexivity condition 
        \begin{align*}
            smo;iwo
        \end{align*}
    \end{property}

    \begin{proof}
        Expanding for implied write order as per the definition, gives us the following two sequential compositions. 
        \begin{align*}
            smo;w_i^j;po;rf^{-1};w_k^j \\
            smo;w_i^j;rf;po;w_k^j 
        \end{align*}
        If the above relations must be irreflexive, then so should the following: 
        \begin{align*}
            w_k^j;smo;w_i^j;po;rf^{-1} \\
            w_k^j;smo;w_i^j;rf;po     
        \end{align*}
        By Def \ref{SymMemO}, the above can be simplified to
        \begin{align*}
            smo;po;rf^{-1} \\
            smo;rf;po 
        \end{align*}
        Thus, proving our property. 
    \end{proof}

%-----------------------------------------------------------------------------------------------------------------------------------

    \begin{property}
        \label{prop2}
        No write order is implied when a read reads from its own thread's write
    \end{property}

    \begin{proof}
        If the read is from its own thread's write, then we can infer that $i=k$ in both the sequential compositions. Hence  
        \begin{align*}
            w_i^j;rf;po;w_i^j \\
            w_i^j;po;rf^{-1};w_i^j
        \end{align*} 
        which gives us $\reln{w_i^j}{iwo}{w_i^j}$.
        Since implied write orders are only between distinct writes, the property is proven.  
    \end{proof}

    \critic{red}{Perhaps define implied write order as being irreflexive}
        
%-------------------------------------------------------------------------------------------------------------------------------------

    \begin{property}
        \label{prop3}
        Implied write orders between two symmetric threads are reversed when they are swapped.
    \end{property}
        
    \begin{proof}
        Considering first sequential composition, i.e. $w_i^j;rf;po;w_k^j$, expanding gives us the following binary relations involved:
        \begin{align*}
            \reln{w_i^j}{rf}{r_k} \\
            \reln{r_k}{po}{w_k^j}
        \end{align*}
        Swapping thread identities involves swapping the indices $i$ and $k$ for each event, thus giving us 
        \begin{align*}
            \reln{w_k^j}{rf}{r_i} \\
            \reln{r_i}{po}{w_i^j}
        \end{align*}
        Through sequential composition of the above, we get $w_k^j;rf;po;w_i^j$, which by definition is $\reln{w_k^j}{iwo}{w_i^j}$.

        For the second sequential composition, i.e. $w_i^j;po;rf^{-1};w_k^j$, expanding gives us the following binary relations involved:
        \begin{align*}
            \reln{w_i^j}{po}{r_i} \\
            \reln{r_i}{rf^{-1}}{w_k^j}
        \end{align*}
        Swapping thread identities $T_i$ and $T_k$ gives us the following relations 
        \begin{align*}
            \reln{w_k^j}{po}{r_k} \\
            \reln{r_k}{rf^{-1}}{w_i^j}
        \end{align*}
        Whose sequential compostiion gives us $w_k^j;po;rf^{-1};w_i^j$, which by defintion is $\reln{w_k^j}{iwo}{w_i^j}$.
    \end{proof}
        
%-------------------------------------------------------------------------------------------------------------------------------------

    \begin{property}
        \label{prop4}
        There are at most two implied write orders between writes of two threads, with one between writes above the read event and one below. 
    \end{property}
        
    \begin{proof}
        Consider two threads $T_i$ and $T_k$. Suppose we have one implied write order between one of their writes, i.e. 
        \begin{align*}
            \reln{w_i^j}{iwo}{w_k^j}.    
        \end{align*}

        If the above is derived by $w_i^j;po;rf^{-1};w_k^j$ then from Prop \ref{Wabv}, we can infer the two writes are above the read and $T_i$' read being satisfied.  

        Now suppose we have an implied write order between another set of writes, i.e.
        \begin{align*}
            \reln{w_i^l}{iwo}{w_k^l}.    
        \end{align*}
        If the above is derived by $w_i^l;po;rf^{-1};w_k^l$, then by Prop \ref{Wabv} and Def \ref{ReadF}, it violates $\stck{_{rf}}$ functionality. Hence it can only be derived by $w_i^l;rf;po;w_k^l$. From Prop \ref{Wbel}, we can infer that the two writes are below the read and $T_k$'s read being satisfied.  
        
        Suppose a third impleid write order exists of the form 
        \begin{align*}
            \reln{w_i^n}{iwo}{w_k^n}
        \end{align*}
        If the above is derived by $w_i^n;po;rf^{-1};w_k^n$, then by Prop \ref{Wabv} and Def \ref{ReadF}, it violates $\stck{_{rf}}$ functionality. If the above is derived by $w_i^n;rf;po;w_k^n$, then by Prop \ref{Wbel} and Def \ref{ReadF}, it violates $\stck{_{rf}}$ functionality.
        
        Hence, we cannot have any more implied write orders between $T_i$ and $T_j$, thus verifying our property. 
    \end{proof}
        
%--------------------------------------------------------------------------------------------------------------------------------------

    \begin{property}
        \label{prop5}
        Implied write orders between two threads either all respect irreflexivity condition by Prop \ref{prop1} or they all do not.  
    \end{property}

    \begin{proof}
        
        Consider our two threads $T_i$ and $T_k$. 

        For cases where implied write orders are established between wrties of $T_i$ and $T_j$, let us first consider one between writes above the read which respect Prop \ref{prop1}; 
        \begin{align*}
            \reln{w_i^j}{iwo}{w_k^j} \ \wedge \ \reln{w_i^j}{smo}{w_k^j}
        \end{align*}
        By Prop \ref{Wabv}, the implied write order satisfies $T_i$'s read by a reads-from relation with $w_k^j$. 

        The other set of implied write order, by Prop \ref{prop4} can only be between writes below the read. Suppose we have such an order but not respecting Prop \ref{prop1}:
        \begin{align*}
            \reln{w_k^l}{iwo}{w_i^l} \ \wedge \ \reln{w_i^l}{smo}{w_k^l}
        \end{align*}
        By Prop \ref{Wbel}, this implies another $\stck{_{rf}}$ relation with $T_i$'s read. By Def \ref{ReadF} this violates the functional property of $\stck{_{rf}}$. Hence we can only have an implied write order respecting Prop \ref{prop1}.
        \begin{align*}
            \reln{w_i^l}{iwo}{w_k^l} \ \wedge \ \reln{w_i^l}{smo}{w_k^l}
        \end{align*}

        By symmetry, if the implied write order between writes above the read did not respect Prop \ref{prop1}, then so would the writes below the read.  
    \end{proof}

%-------------------------------------------------------------------------------------------------------------------------------------- 
        
    \begin{property}
        \label{prop6}
        Implied write orders are acyclic
    \end{property}

    \begin{proof}
        %By Contradiction 
        Suppose a cycle exists. Then without loss of generality, we can consider the cycle composed of 3 writes.
        \begin{align*}
            \reln{w_i^j}{iwo}{w_k^j} \ \wedge \reln{w_k^j}{iwo}{w_l^j} \ \wedge \reln{w_l^j}{iwo}{w_i^j}.  
        \end{align*}
        
        By Def \ref{ImpliedW} and Prop \ref{Wabv}, \ref{Wbel}, we can have just two cases; the set of writes involved in cycle are either above the read event or below.

        If they are above the read, then we have the following relations that result in the cycle
        \begin{align*}
            \reln{w_i^j}{po}{r_i} \ \wedge \ \reln{r_i}{rf^{-1}}{w_k^j} \\
            \reln{w_k^j}{po}{r_k} \ \wedge \ \reln{r_k}{rf^{-1}}{w_l^j} \\
            \reln{w_l^j}{po}{r_l} \ \wedge \ \reln{r_l}{rf^{-1}}{w_i^j}. 
        \end{align*}
        The above relations violate $po \cup rf^{-1} \ \text{acyclic}$ rule, thus violating coherence.
        
        If the writes are below the read, then we have the following relations that result in the above cycle.
        \begin{align*}
            \reln{w_i^j}{po}{r_i} \ \wedge \ \reln{r_i}{rf}{w_k^j} \\
            \reln{w_k^j}{po}{r_k} \ \wedge \ \reln{r_k}{rf}{w_l^j} \\
            \reln{w_l^j}{po}{r_l} \ \wedge \ \reln{r_l}{rf}{w_i^j} 
        \end{align*}
        The above relations form a cycle thus violating $po \cup rf \ \text{acyclic}$ rule, thus violating coherence.

        Because both cases violate coherence, we conclude that $\stck{_{iwo}}$ is acylic. 
    \end{proof}

%---------------------------------------------------------------------------------------------------------------------------------------

    \begin{property}
        \label{prop7}
        Writes $w_i$ above read in each thread can only have one relation of the form $\reln{w_i}{iwo}{w}$ but can have several of the form $\reln{w}{iwo}{w_i}$. 
    \end{property}

    \begin{proof}
        Suppose a write $w_i^j$ above a read has a relation with $w_k^j$ such that $\reln{w_i^j}{iwo}{w_k^j}$. By Prop \ref{Wabv}, we can infer $T_i$'s read has been satisfied. By Def \ref{ReadF} and our assumption of one read per thread, we cannot have any more implied write order relations of the form $\reln{w_i^j}{iwo}{w^j}$. 

        On the other hand, there can be many relations of the form $\reln{w_k^j}{iwo}{w_i^j}$ as $k$ can be identity of any thread, whose read gets satisfied by the argument above.
    \end{proof}

%---------------------------------------------------------------------------------------------------------------------------------------
   
    \begin{property}
        \label{prop8}
        Writes $w_i$ below read in each thread can only have one relation of the form $\reln{w}{iwo}{w_i}$ but can have several of the form $\reln{w_i}{iwo}{w}$. 
    \end{property}

    \begin{proof}
        Suppose a write $w_i^j$ below the read has a relation with $w_k^j$ such that $\reln{w_k^j}{iwo}{w_i^j}$. By Prop \ref{Wbel}, we can infer that $T_i$'s read has been satisfied by write $w_k^j$. By Def \ref{ReadF} and our assumption of one read per thread, we cannot have any more implied write order relations of the form $\reln{w^j}{iwo}{w_i^j}$. 

        On the other hand, there can be many relations of the form $\reln{w_i^j}{iwo}{w_k^j}$ as $k$ can be identity of any thread, whose read gets satisfied by the argument above.  
    \end{proof}

%----------------------------------------------------------------------------------------------------------------------------------------
%----------------------------------------------------------------------------------------------------------------------------------------

    \subsubsection{Soundness}

        To prove that our rules are sound, we need to show that for every execution graph that does not respect the irreflexivity constraint, there is a symmetric execution that does respect and hence covered by our rules. 
        
        By Prop \ref{prop1}, we can infer that an execution not respectiing our irreflexivity constraint will have implied write orders which are "incorrect". 

        \critic{red}{Perhaps put Incorrect implied write orders as a definition??}
        
        By Prop \ref{prop3}, we can swap thread identities to reverse implied write orders, thus "fixing" implied write orders, which then can make the resultant execution respect our rules. 

        If we can show this process of "fixing" implied write orders is terminating, our soundness proof is complete. 

        For this, we first need to ensure that implied write orders do not form a cycle. As "fixing" them may not terminate.  By Prop \ref{prop6}, we have that $\stck{_{iwo}}$ is acyclic, hence they do not form a cycle.  
        
        Given this, we show that for one given set of equal writes, swapping thread identities will always result in the implied write orders respecting Prop \ref{prop1}. 
        Finally, we show that this holds in general given multiple sets of equal writes.  

%------------------------------------------------------------------------------------------------------------------------------------------

        \begin{lemma}
            For one given set of equal writes, every implied write order that is "incorrect", can be fixed and will remain fixed.  
            (A more formal statement required perhaps?)
        \end{lemma}
            
        \begin{proof}
            %Proof by contradiction 
            Suppose we have one implied write order which is correct / fixed between writes $w_i^j$ and $w_k^j$.
            \begin{align*}
                \reln{w_i^j}{iwo}{w_k^j}
            \end{align*}
            
            We divide our proof into two cases, one for writes above the read and one for writes below. 

            \paragraph{Case1 : The writes are above the read} 
                
                \begin{itemize}
                    \item Part 1: There exists an implied write order between $w_i^j$ and some $w_m^j$
                    
                        Because Prop \ref{prop7} and $\reln{w_i^j}{iwo}{w_k^j}$, other implied write orders with $w_i^j$ can be of the form:
                        \begin{align*}
                            \reln{w_m^j}{iwo}{w_i^j}
                        \end{align*}
                        If this implied order is wrong, swapping thread identities will  give us the following relations 
                        \begin{align*}
                            \reln{w_i^j}{iwo}{w_m^j} \ \wedge \ \reln{w_m^j}{iwo}{w_k^j}  
                        \end{align*}  
                        Here, there is no implied write order relation between $w_i^j$ and $w_k^j$, hence we can consider them as remaining fixed. 
                        If the implied order between $w_m^j$ and $w_k^j$ is wrong, swapping it will result in the following relations
                        \begin{align*}
                            \reln{w_i^j}{iwo}{w_k^j} \ \wedge \ \reln{w_k^j}{iwo}{w_m^j}  
                        \end{align*}  
                        Here, the implied write order between $w_i^j$ and $w_k^j$ remains the same. Thus, for this case, we can conclude    that   the   relation remains "fixed".

                    \item Part 2: There exists an implied write order between $w_k^j$ and some $w_m^j$
                
                        By Prop \ref{prop7}, implied write orders with $w_k^j$ can be of the forms:
                        \begin{align*}
                            \reln{w_k^j}{iwo}{w_m^j} \\
                            \reln{w_m^j}{iwo}{w_k^j} 
                        \end{align*} 
                        The first form is symmetric to Case1, hence we only consider the second form. 

                        If this implied write order is wrong, swapping thread identities will give us the following relations. 
                        \begin{align*}
                            \reln{w_i^j}{iwo}{w_m^j} \ \wedge \ \reln{w_k^j}{iwo}{w_m^j}
                        \end{align*}
                        Here, there is no implied write order relation between $w_i^j$ and $w_k^j$, hence we can consider them as remaining fixed. 

                        If the implied write order between $w_m^j$ and $w_i^j$ is wrong, swapping their threads will give us 
                        \begin{align*}
                            \reln{w_m^j}{iwo}{w_i^j} \ \wedge \ \reln{w_k^j}{iwo}{w_i^j}  
                        \end{align*}
                        thus making our claim invalid. To show that this state is not possible, note firstly that from the initial  configuration,   we    can infer by Def \ref{SymMemO} and Prop \ref{prop1}:
                        \begin{align*}
                            \reln{w_i^j}{smo}{w_k^j} \ \wedge \ \reln{w_k^j}{smo}{w_m^j}
                        \end{align*} 
                        Because $smo$ is a total order w.r.t. one set of writes, we have by transitivity. 
                        \begin{align*}
                            \reln{w_i^j}{smo}{w_m^j}
                        \end{align*}
                        After swapping threads $T_k$ and $T_m$, we get $\reln{w_i^j}{iwo}{w_m^j}$ which respects the irreflexivity constraint   Prop  \ref {prop1}. Hence, this implied write order is not wrong. Thus we cannot have the case which results in $\reln{w_k^j}{iwo}{w_i^j}$.  
                        
                    \end{itemize}

            \paragraph{Case2: The writes are below the read} 

                \begin{itemize}
                    \item Part 1: There exists an implied write order between $w_i^j$ and some $w_m^j$
                    
                        By Prop \ref{prop8}, implied write order between $w_i^j$ and $w_m^j$ can be of two forms 
                        \begin{align*}
                            \reln{w_m^j}{iwo}{w_i^j} \\ 
                            \reln{w_i^j}{iwo}{w_m^j}
                        \end{align*}

                        Considering the first form, if it is wrong, swapping it will result in the following relations 
                        \begin{align*}
                            \reln{w_i^j}{iwo}{w_m^j} \ \wedge \ \reln{w_m^j}{iwo}{w_k^j}
                        \end{align*}
                        Here, there is no implied write order relation between $w_i^j$ and $w_k^j$, hence we can consider them as remaining fixed. 

                        If the implied write order between $w_m^j$ and $w_k^j$ is wrong, swapping their threads will give us
                        \begin{align*}
                            \reln{w_i^j}{iwo}{w_k^j} \ \wedge \ \reln{w_k^j}{iwo}{w_m^j}
                        \end{align*} 
                        Here, the implied write order between $w_i^j$ and $w_k^j$ remains the same, while we fixed the relations they had with $w_m^j$. Thus, for this case, we can conclude that the implied write order remains "fixed".

                        Considering the second form, if it is wrong, swapping it will result in the following relations 
                        \begin{align*}
                            \reln{w_m^j}{iwo}{w_i^j} \ \wedge \ \reln{w_m^j}{iwo}{w_k^j}
                        \end{align*}

                        If the implied write order between $w_m^j$ and $w_i^j$ is wrong, swapping their threads will give us 
                        \begin{align*}
                            \reln{w_k^j}{iwo}{w_m^j} \ \wedge \ \reln{w_k^j}{iwo}{w_i^j}  
                        \end{align*}
                        thus making our claim invalid. To show that this state is not possible, note firstly that from the initial  configuration, we can infer by Def \ref{SymMemO} and Prop \ref{prop1} (given relation between $w_i^j$ and $w_m^j$ is wrong):
                        \begin{align*}
                            \reln{w_m^j}{smo}{w_i^j} \ \wedge \ \reln{w_i^j}{smo}{w_k^j}
                        \end{align*}
                        Because $smo$ is a total order w.r.t. one set of writes, we have by transitivity. 
                        \begin{align*}
                            \reln{w_m^j}{smo}{w_k^j}
                        \end{align*}

                        After swapping threads $T_i$ and $T_m$, we get $\reln{w_m^j}{iwo}{w_k^j}$ which respects the irreflexivity constraint Prop \ref{prop1}. Hence, this implied write order is not wrong. Thus we cannot have the case which results in $\reln{w_k^j}{iwo}{w_i^j}$.

                    \item Part 2: There exists an implied write order between $w_k^j$ and some $w_m^j$
                    
                        By Prop \ref{prop8} and $\reln{w_i^j}{iwo}{w_k^j}$, relation between $w_k^j$ and $w_m^j$ can only be of one form 
                        \begin{align*}
                            \reln{w_k^j}{iwo}{w_m^j}
                        \end{align*}
                        This case is symmetric to the first form of Part 1, hence this case is already proved. 
                
                \end{itemize}
 
            Thus, for a given set of equal writes, once an implied write order is fixed, it remains fixed.
        \end{proof}

%------------------------------------------------------------------------------------------------------------------------------------------

        \begin{lemma}
            For a given set of equal writes whose implied write orders respect Prop \ref{prop1},  new implied write order introduced among them by fixing other sets, if wrong, can be fixed and will remain fixed. 
            (A more formal statement required? Discuss with Viktor)        
        \end{lemma}

        \begin{proof}{Part 1}
            Suppose, for a given set of equal writes, say of the form $w^j$ all the implied write orders are fixed. Let us consider them to be wrties above the read. We consider two threads $T_i$ and $T_k$, between which an implied write order is wrong. Let those writes be $w_i^l$ and $w_k^l$. 

            Without loss of generality, let us consider the symmetric memory order between writes of $T_i$ and $T_k$ to be of the form $\reln{w_i}{smo}{w_k}$. Thus we have 
            \begin{align*}
                \reln{w_i^j}{smo}{w_k^j} \ \wedge \ \reln{w_i^l}{smo}{w_k^l}
            \end{align*}

            We assume write order is wrong between $w_i^l$ and $w_k^l$
            \begin{align*}
                \reln{w_k^l}{iwo}{w_i^l}
            \end{align*} 
            There cannot be an implied write order between $w_i^j$ and $w_k^j$, by Prop \ref{prop5}. 

            \paragraph{Case1: $w^l$ is below the read.}
                
                \begin{itemize}
                    \item Part1: There exists an implied write order between another write $w^j$ and $w_i^j$. 

                        By \ref{prop7} and $\reln{w_k^l}{iwo}{w_i^l}$, thus satisfying $T_i$'s read, $w_i^j$ can only be involved in implied    write orders of the form 
                        \begin{align*}
                            \reln{w^j}{iwo}{w_i^j}
                        \end{align*}
                        From our assumption of implied write orders among $w^j$ are fixed already, we have
                        \begin{align*}
                            \reln{w^j}{smo}{w_i^j} 
                        \end{align*} 
                        By Def \ref{SymMemO}, we then have $\reln{w^j}{smo}{w_k^j}$.

                        By Prop \ref{prop3}, swapping $T_i$ and $T_k$ to fix $\reln{w_k^l}{iwo}{w_i^j}$, gives us the following new relations.
                        \begin{align*}
                            \reln{w_i^l}{iwo}{w_k^j} \\
                            \reln{w^j}{iwo}{w_k^j}
                        \end{align*}
                        Both these relations repsect our irreflexivity constraint Prop \ref{prop1}. Thus, concluding this part. 

                    \item Part2: There exists an implied write order between another write $w^j$ and $w_k^j$. 

                        By Prop \ref{prop7}, $w_k^j$ can be involved in implied write orders of the form
                        \begin{align*}
                            \reln{w_k^j}{iwo}{w^j} \\
                            \reln{w^j}{iwo}{w_k^j} 
                        \end{align*}
                        The first is symmetric to Part1, hence we only consider the second form. 

                        By Prop \ref{prop3}, on swapping $T_i$ and $T_k$, we get the following new relations:
                        \begin{align*}
                            \reln{w_i^l}{iwo}{w_k^j} \\
                            \reln{w^j}{iwo}{w_i^j}
                        \end{align*}

                        The second one may not be compliant to the irreflexivity condition Prop \ref{prop1}, hence can be a new implied    relation which is wrong. To show that this can be fixed and will remain fixed, we need to show that this is new and could have not occurred before while swapping threads to fix implied write orders of $w^j$. 

                        Consider the original configuration we have 
                        \begin{align*}
                            \reln{w_i^j}{smo}{w_k^j} \ \wedge \ \reln{w^j}{iwo}{w_k^j}
                        \end{align*}
                        For $\reln{w^j}{iwo}{w_k^j}$ to have been there before, there must be a write $x$, say, such that 
                        \begin{align*}
                            \reln{x}{iwo}{w_i^j} \ \wedge \ \reln{x}{iwo}{w^j}
                        \end{align*}
                        By Prop \ref{prop7}, such an $x$ cannot exist, Hence, such a relation could have not been there before, and hence was   not fixed before.

                \end{itemize}
                    Now that this new relation exists, fixing it, will keep it remain fixed, by our first part of proof (label them please. 
                    
            
            \paragraph{Case2: $w^l$ is above the read.}
                
                \begin{itemize}
                    \item Part1: There exists an implied write order between another write $w^j$ and $w_i^j$.

                        Since $T_i$'s read is still free, $w_i^j$ can have implied write orders with $w^j$ of the form
                        \begin{align*}
                            \reln{w^j}{iwo}{w_i^j} \\
                            \reln{w_i^j}{iwo}{w^j} 
                        \end{align*}

                        For the first form of relation, note that we also have by Prop \ref{prop1} and by Def \ref{SymMemO}, 
                        \begin{align*}
                            \reln{w^j}{smo}{w_i^j} \ \wedge \ \reln{w^j}{smo}{w_k^j}
                        \end{align*}

                        By Prop \ref{prop3} on swapping two threads $T_i$ and $T_k$, we have 
                        \begin{align*}
                            \reln{w_i^l}{iwo}{w_k^j} \\
                            \reln{w^j}{iwo}{w_k^j}
                        \end{align*}

                        Both relations respect our irreflexivity constraint.  Hence, maintaining that new implied write order relations with    $w^j$  are not wrong.

                        For the second form, while we swap threads $T_i$ and $T_k$, we get the following new relations (correct his)
                        \begin{align*}
                            \reln{w_i^l}{iwo}{w_k^j} \\
                            \reln{w_k^j}{iwo}{w^j}
                        \end{align*}
                        The second relation may not be compliant to the irreflexivity condition, hence can be a new implied relation which  is   wrong. To show that this is new and could have not occurred before while swapping threads to fix implied write  orders of  $w^j$, consider the original configuration we have 
                        \begin{align*}
                            \reln{w_i^j}{smo}{w_k^j} \ \wedge \ \reln{w_i^j}{iwo}{w^j}
                        \end{align*}

                        For $\reln{w^j}{iwo}{w_k^j}$ to have been there before, we need an event $x$ to connect, hence by possible implied write orders one can have with $w^j$ and $w_k^j$, we need an $x$ such that one of the conditions below hold
                        \begin{align*}
                            \reln{w^j}{iwo}{x} \ \wedge \ \reln{x}{iwo}{w_k^j} \\ 
                            \reln{x}{iwo}{w^j} \ \wedge \ \reln{x}{iwo}{w_k^j}
                        \end{align*}

                        The first condition violates coherence ($po \cup rf_{-1}$ acylcic), while the second condition cannot hold as such  an   event $x$ cannot exist due to property x (number the properties).

                        Thus, such a relation could have not been there before, and hence was not fixed. 

                        \critic{red}{Write the above argument better please.}

                    \item Part2: There exists an implied write order between another write $w^j$ and $w_k^j$.

                        Since $T_k$'s read is already established in a reads-from relation, by Prop \ref{prop7}, $w_k^j$ can have implied   write     orders with some $w^j$ only of the form 
                        \begin{align*}
                            \reln{w^j}{iwo}{w_k^j}
                        \end{align*}

                        By Prop \ref{prop3}, swapping thread identities $T_i$ and $T_k$ will give us the following relations 
                        \begin{align*}
                            \reln{w_i^l}{iwo}{w_k^l} \\ 
                            \reln{w^j}{iwo}{w_i^j} 
                        \end{align*}
                        The second relation may not be compliant to the irreflexivity condition, hence can be a new implied relation which  is   wrong. To show that this is new and could have not occurred before while swapping threads to fix implied write  orders of  $w^j$, consider the original configuration we have 
                        \begin{align*}
                            \reln{w_i^j}{smo}{w_k^j} \ \wedge \ \reln{w^j}{iwo}{w_k^j}
                        \end{align*}

                        For $\reln{w^j}{iwo}{w_i^j}$ to have been there before, we need an event $x$ to connect, hence by possible implied  write    orders one can have with $w^j$ and $w_k^j$. By Prop \ref{prop7}, $w^j$ can only have relations of the form  $\reln{w}{iwo}{w^j}$. Thusm we have the possible two forms of relations that could exist:
                        \begin{align*}
                            \reln{x}{iwo}{w^j} \ \wedge \ \reln{w_i^j}{iwo}{x} \\
                            \reln{x}{iwo}{w^j} \ \wedge \ \reln{x}{iwo}{w_i^j} \\ 
                        \end{align*}

                        The second form cannot exist due to Prop \ref{prop7}. While the first form could exist, it violates coherence ($po  \cup rf_ {-1}$ acylcic). 

                        Thus, such a relation could have not been there before, and hence was not fixed. 

                \end{itemize}
            
            \critic{red}{Although the soundness proof is written completely, it requires proper formatting and references to the properties and definitions we wrote above. This will make it concicse and a lot of symmetric arguments can be avoided.}
        \end{proof}

        \begin{proof}{Part 2}
            Suppose, for a given set of equal writes, say of the form $w^j$ all the implied write orders are fixed. Let us consider them to be wrties below the read. We consider two threads $T_i$ and $T_k$, between which an implied write order is wrong. Let those writes be $w_i^l$ and $w_k^l$. 

            Without loss of generality, let us consider the symmetric memory order between writes of $T_i$ and $T_k$ to be of the form $\reln{w_i}{smo}{w_k}$. Thus we have 
            \begin{align*}
                \reln{w_i^j}{smo}{w_k^j} \ \wedge \ \reln{w_i^l}{smo}{w_k^l}
            \end{align*}
            We also have 
            \begin{align*}
                \reln{w_k^l}{iwo}{w_i^l}
            \end{align*}

            There cannot be an implied write order between $w_i^j$ and $w_k^j$, by Prop \ref{prop5}. 

            \paragraph{Case 1: $w^l$ is abvoe the read.}

                \begin{itemize}
                    \item Part 1: There exists an implied write order between another write $w^j$ and $w_i^j$.

                        By Prop \ref{prop8}, implied write orders between some $w^j$ and $w_i^j$ can only be of the form:
                        \begin{align*}
                            \reln{w^j}{iwo}{w_i^j}
                            \reln{w_i^j}{iwo}{w^j}
                        \end{align*}

                        For the first form of relation, note that we also have by Prop \ref{prop1} and by Def \ref{SymMemO}, 
                        \begin{align*}
                            \reln{w^j}{smo}{w_i^j} \ \wedge \ \reln{w^j}{smo}{w_k^j}
                        \end{align*}

                        By Prop \ref{prop3} on swapping threads $T_i$ and $T_j$, we have 
                        \begin{align*}
                            \reln{w_i^l}{iwo}{w_k^l} \\ 
                            \reln{w^j}{iwo}{w_k^j}
                        \end{align*}
                        Both these relations respect our irreflexivity constraint Prop \ref{prop1}, hence we can conclude this case. 

                        For the second form of relation, note that after swapping we have 
                        \begin{align*}
                            \reln{w_i^l}{iwo}{w_k^l} \\ 
                            \reln{w_k^j}{iwo}{w^j}    
                        \end{align*}

                        The latter relation may not respect our irreflexivity constraint, and hence can be wrong. To show that this implied write order could not have existed and hence fixed before, we observe the original configuration
                        \begin{align*}
                            \reln{w_i^j}{iwo}{w^j} \ \wedge \reln{w_i^j}{smo}{w_k^j}
                        \end{align*}

                        To have had $\reln{w_k^j}{iwo}{w^j}$ before there must have been an event $x$, that must have connected both those events with a fixed implied write order. By Prop \ref{prop8} and Prop \ref{Wabv}, such an $x$ can only exist with the following relations
                        \begin{align*}
                            \reln{w^j}{iwo}{x} \ \wedge \ \reln{w_k^j}{iwo}{x}                            
                        \end{align*} 
                        By by Prop \ref{prop8}, such an event cannot exist. Thus, the new implied write order had not been fixed before and hence, by lemma 1, can be fixed and will remain fixed. 

                    \item Part 2: There exists an implied write order between another write $w^j$ and $w_k^j$.
                        
                        By Prop \ref{prop8} and Prop \ref{Wabv}, implied write orders between $w^j$ and $w_k^j$ can only be of the form 
                        \begin{align*}
                            \reln{w_k^j}{iwo}{w^j}
                        \end{align*}
                        
                        For the first form of relation, note that we also have by Prop \ref{prop1} and by Def \ref{SymMemO}, 
                        \begin{align*}
                            \reln{w_k^j}{smo}{w^j} \ \wedge \ \reln{w_i^j}{smo}{w^j}
                        \end{align*}

                        By Prop \ref{prop3} on swapping threads $T_i$ and $T_j$, we have 
                        \begin{align*}
                            \reln{w_i^l}{iwo}{w_k^l} \\ 
                            \reln{w_i^j}{iwo}{w^j}
                        \end{align*}
                        Both these relations respect our irreflexivity constraint Prop \ref{prop1}, hence we can conclude this case. 

                \end{itemize}

            \paragraph{Case 2: $w^l$ is below the read.}

                \begin{itemize}
                    \item Part 1: There exists an implied write order between another write $w^j$ and $w_i^j$.
                        By Prop \ref{prop8} and Prop \ref{Wbel}, implied write order between $w^j$ and $w_i^j$ can be of the form 
                        \begin{align*}
                            \reln{w_i^j}{iwo}{w^j}
                        \end{align*}

                        By Prop \ref{prop1}, on swapping, we have the following relations 
                        \begin{align*}
                            \reln{w_i^l}{iwo}{w_k^l} \\ 
                            \reln{w_k^j}{iwo}{w^j}
                        \end{align*}

                        The latter relation may not respect our irreflexivity constraint. To show that this relation could not have been there before and thus can be fixed by Lemma 1, consider the original configuration
                        \begin{align*}
                            \reln{w_i^j}{iwo}{w^j} \ \wedge \ \reln{w_i^j}{smo}{w_k^j}
                        \end{align*}

                        For $\reln{w_k^j}{iwo}{w^j}$ to have been there before, we need an event $x$ to connect, having implied write orders with both. By Prop \ref{prop8}, $w^j$ can only have relations of the form  $\reln{w^j}{iwo}{w}$. Thus we have the possible two forms of relations that could exist:
                        \begin{align*}
                            \reln{w^j}{iwo}{x} \ \wedge \ \reln{x}{iwo}{w_k^j} \\ 
                            \reln{w^j}{iwo}{x} \ \wedge \ \reln{w_k^j}{iwo}{x}
                        \end{align*}

                        The first set of relations violate coherence ($po \cup rf$ acyclic), while the second set of relations is not possible as due to Prop \ref{prop8}, such an event $x$ cannot exist. 

                        Thus, the implied write order if exists after swapping, is new and could not have occured before and hence, by Lemma 1, we can fix it and will remain fixed. 

                    \item Part 2: There exists an implied write order between another write $w^j$ and $w_i^j$.
                    
                        By Prop \ref{prop8}, implied write orders between $w^j$ and $w_k^j$ can be of the form
                        \begin{align*}
                            \reln{w_k^j}{iwo}{w^j} \\ 
                            \reln{w^j}{iwo}{w_k^j}
                        \end{align*} 

                        Taking the first form, by Prop \ref{prop1} and Def \ref{SymMemO}, we have 
                        \begin{align*}
                            \reln{w_k^j}{smo}{w^j} \ \wedge \ \reln{w_i^j}{smo}{w^j}
                        \end{align*}

                        By Prop \ref{prop3}, on swapping, we have 
                        \begin{align*}
                            \reln{w_i^l}{iwo}{w_k^l} \\ 
                            \reln{w_i^j}{iwo}{w^j}                         
                        \end{align*}

                        None of the above relations violate the irreflexivity constraint Prop \ref{prop1}. Hence, for this case, we are done. 

                        For the second form, on swapping we have 
                        \begin{align*}
                            \reln{w_i^l}{iwo}{w_k^l} \\ 
                            \reln{w^j}{iwo}{w_i^j}
                        \end{align*}

                        The latter relation may not respect our irreflexivity constraint. To show that this relation could not have been there before and thus can be fixed by Lemma 1, consider the original configuration
                        \begin{align*}
                            \reln{w_i^j}{smo}{w_k^j} \ \wedge \ \reln{w^j}{iwo}{w_k^j}
                        \end{align*}

                        For $\reln{w^j}{iwo}{w_i^j}$ to have been there before, we need an event $x$ to connect, having implied write orders with both. By Prop \ref{prop8}, $w_i^j$ can only have relations of the form  $\reln{w_i^j}{iwo}{w}$. Thus we have the possible two forms of relations that could exist:
                        \begin{align*}
                            \reln{w_i^j}{iwo}{x} \ \wedge \reln{x}{iwo}{w^j} \\ 
                            \reln{w_i^j}{iwo}{x} \ \wedge \reln{w^j}{iwo}{x} \\ 
                        \end{align*}

                        The first set of relations violate coherence, ($po \cup rf$ acyclic). While the second one, by Prop \ref{prop8}, such an $x$ cannot exist. Hence, our relation is new and could not have occured before, and thus can be fixed by Lemma 1 and remain fixed.

                \end{itemize}

            
        \end{proof}
   